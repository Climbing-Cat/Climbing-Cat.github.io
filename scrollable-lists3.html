<html>

	<head>
		<title>WiKiMedia Player</title>

		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css"/>

		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<link type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/themes/blitzer/jquery-ui.min.css" rel="stylesheet" />
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>


		<style type="text/css">
			body {
			  margin: 10px;
			}

			.glyphicon-move {
			  cursor: move;
			  cursor: -webkit-grabbing;
			}

			.blue-background-class {

			  background-color: #5555f1aa;
			}
			
			
			/* Style the tab */
			.tab {
			  float: left;
			  border: 1px solid #ccc;
			  background-color: #f1f1f1;
			  width: 8%;
			  height: 300px;
			}

			
			/* Style the buttons inside the tab */
			.tab button {
			  display: block;
			  background-color: inherit;
			  color: black;
			  padding: 22px 16px;
			  width: 100%;
			  border: none;
			  outline: none;
			  text-align: left;
			  cursor: pointer;
			  font-size: 17px;
			}

			/* Change background color of buttons on hover */
			.tab button:hover {
			  background-color: #ddd;
			}

			/* Create an active/current "tab button" class */
			.tab button.active {
			  background-color: #ccc;
			}

			/* Style the tab content */
			.tabcontent {
			  float: left;
			  padding: 0px 12px;
			  border: 1px solid #ccc;
			  width: 70%;
			  border-left: none;
			  height: 300px;
			  display: none;
			}

			/* Clear floats after the tab */
			.clearfix::after {
			  content: "";
			  clear: both;
			  display: table;
			}

			/*CSS hide scroll bar, but have element scrollable*/
			/*https://stackoverflow.com/questions/43186015/css-hide-scroll-bar-but-have-element-scrollable/43186311	*/
			.hide-scrollbar::-webkit-scrollbar {
				width: 0px;
				background: transparent; /* make scrollbar transparent */
			}
		</style>
	</head>

	<body>
		<div style="width: 100%; height: 30px;">
			<div style="text-align: center;">
				<div style="display: inline-block;">
					<h1>WiKiMedia Player</h1>
					<h5 style="text-align:right;"><i>by Climbing-Cat</i></h5>
				</div>
			</div>
			</br>
	

			<div id="tab" class="tab">
			  <button id="LondonButton" class="tablinks" data-city="London">London</button>
			  <button id="ParisButton" class="tablinks" data-city="Paris">Paris</button>
			  <button id="TokyoButton" class="tablinks" data-city="Tokyo">Tokyo</button>
			</div>

			
			<div id="London" class="tabcontent">
			  <h4>London</h4>
				<!-- List with handle -->
				<div id="list0WithHandle" class="list-group">
					<div class="list-group-item">
						<span class="badge">14</span>
						<span class="glyphicon glyphicon-move" aria-hidden="true"></span>
						Chisel
					</div>
					<div class="list-group-item">
						<span class="badge">2</span>
						<span class="glyphicon glyphicon-move" aria-hidden="true"></span>
						Crimp
					</div>
					<div class="list-group-item">
						<span class="badge">1</span>
						<span class="glyphicon glyphicon-move" aria-hidden="true"></span>
						Drag!
					</div>
				</div>		
			</div>

			<div id="Paris" class="tabcontent" >
			  <h4>Paris</h4>
				<!-- List with handle -->
				<div id="list1WithHandle" class="list-group" style="height: 200px; overflow-y:   scroll;">
					<div class="list-group-item">
						<span class="badge">14</span>
						<span class="glyphicon glyphicon-move" aria-hidden="true"></span>
						cat
					</div>
					<div class="list-group-item">
						<span class="badge">2</span>
						<span class="glyphicon glyphicon-move" aria-hidden="true"></span>
						snarf
					</div>
					<div class="list-group-item">
						<span class="badge">1</span>
						<span class="glyphicon glyphicon-move" aria-hidden="true"></span>
						miumiu!
					</div>
				</div>		
			</div>

			<div id="Tokyo" class="tabcontent">
			  <h4>Tokyo</h4>
				<!-- List with handle -->
				<div id="list2WithHandle"  class="list-group hide-scrollbar" style="height: 200px; overflow-y:   scroll;">
					<div class="list-group-item">
						<span class="badge">14</span>
						<span class="glyphicon glyphicon-move" aria-hidden="true"></span>
						Drag me by the handle
					</div>
					<div class="list-group-item">
						<span class="badge">2</span>
						<span class="glyphicon glyphicon-move" aria-hidden="true"></span>
						You can also select text
					</div>
					<div class="list-group-item">
						<span class="badge">1</span>
						<span class="glyphicon glyphicon-move" aria-hidden="true"></span>
						Best of both worlds!
					</div>

				</div>		
			</div>

			<div class="clearfix"></div>

			<div style="display: none;">
				X: <input id="x" type="text" name="x" value="0" ></input>
				Y: <input id="y" type="text" name="y" value="0" ></input>
			</div>
			<textarea id="textareaP" style="width: 100%; resize: none;" rows="6"></textarea>
			  <button id="ClearParisButton" class="tablinks" onmouseover="textareaP.value = ''">Paris</button></br>

			<textarea id="textareaT" style="width: 100%; resize: none;" rows="6"></textarea>
			  <button id="ClearTokyoButton" class="tablinks" onmouseover="textareaT.value = ''">Tokyo</button></br>

				
			<script>
			</script>
			</br>
			</br>
			</br>
			</br>

		</div>

		<script>

		function openCity(cityName) {
			var i, tabcontent, tablinks;
			tabcontent = document.getElementsByClassName("tabcontent");
			for (i = 0; i < tabcontent.length; i++) {
				tabcontent[i].style.display = "none";
			}
var classP = ParisButton.className + "\r\n\r\n";
var classT = TokyoButton.className + "\r\n\r\n";

			tablinks = document.getElementsByClassName("tablinks");
			for (i = 0; i < tablinks.length; i++) {
				//tablinks[i].className = tablinks[i].className.replace(" active", "");
				$(tablinks[i]).removeClass("active");
			}
			document.getElementById(cityName).style.display = "block";
			//document.getElementById(cityName + 'Button').className += " active";
			$(document.getElementById(cityName + 'Button')).addClass("active");

classP += ParisButton.className;
classT += TokyoButton.className;

			$("#textareaP").val(classP);
			$("#textareaT").val(classT);
		}

			$(".tablinks").on("mouseover touchstart", function(){
				var city = $(this).data("city");
				openCity(city);
			});

			
			$(document).ready(function() {
				//fixes same page links on github pages. Maybe base ref is not set correctly?
				//regardless, clicking a link now does nothing instead of going to the top of the page
				$('a[href="#"]').prop('href','javascript:void(0);');


				function TabButtonRect(l, r, t, b) {
					this.left = l;
					this.right = r;
					this.top = t;
					this.bottom = b;

					this.contains = function (x, y) {
						return this.left <= x && x <= this.right &&
							   this.top <= y && y <= this.bottom;
					}
					
					this.print = function() {
						console.log(this.left);
						console.log(this.right);
						console.log(this.top);
						console.log(this.bottom);
					}
				}

				function getElementPageCoordinates(elem)
				{
					var os = $(elem).offset();
					var l = os.left;
					var r = os.left + elem.scrollWidth; //https://stackoverflow.com/questions/10277323/get-real-width-of-elements-with-jquery
					var t = os.top;
					var b = os.top + elem.scrollHeight;

					return  new TabButtonRect(l, r, t, b);
				}
				

				var tabsRect = getElementPageCoordinates(tab);
				var londonRect = getElementPageCoordinates(LondonButton);
				var parisRect = getElementPageCoordinates(ParisButton);
				var tokyoRect = getElementPageCoordinates(TokyoButton);

				tabsRect.print();
				parisRect.print();
				londonRect.print();
				tokyoRect.print();


				var sortable = Sortable.create(list0WithHandle, {
					handle: '.glyphicon-move',
					group: 'shared', // set lists to same group
					animation: 0,
					scroll: true,
					bubbleScroll: true,
					scrollSensitivity: 40,
					scrollSpeed: 10,
					forceFallback: true,
					fallbackOnBody: true,
					
					onStart: function (evt) {
						commonOnStartCallback(evt);
					},
					onEnd: function (evt) {
						commonOnEndCallback(evt);
					},
				});

				var sortable = Sortable.create(list1WithHandle, {
					handle: '.glyphicon-move',
					group: 'shared', // set lists to same group
					animation: 0,
					scroll: true,
					bubbleScroll: true,
					scrollSensitivity: 40,
					scrollSpeed: 10,
					forceFallback: true,
					fallbackOnBody: true,
					
					onStart: function (evt) {
						commonOnStartCallback(evt);
					},
					onEnd: function (evt) {
						commonOnEndCallback(evt);
					},
				});

				var sortable = Sortable.create(list2WithHandle, {
					handle: '.glyphicon-move',
					group: 'shared', // set lists to same group
					animation: 0,
					scroll: true,
					bubbleScroll: true,
					scrollSensitivity: 40,
					scrollSpeed: 10,
					forceFallback: true,
					fallbackOnBody: true,
					
					onStart: function (evt) {
						commonOnStartCallback(evt);
					},
					onEnd: function (evt) {
						commonOnEndCallback(evt);
					},
				});
				
				function commonOnStartCallback(evt) {
					//https://github.com/SortableJS/Sortable/issues/1292
					//document.addEventListener('mousemove', mousePosition, false);
					document.addEventListener('touchmove', touchPosition, false);
					console.log("start");
					
					touchStartOffsetX = evt.originalEvent.offsetX;
					touchStartOffsetY = evt.originalEvent.offsetY;
				}
				function commonOnEndCallback(evt) {
					//https://github.com/SortableJS/Sortable/issues/1292
					document.removeEventListener('touchmove', touchPosition, false);
					//document.removeEventListener('mousemove', mousePosition, false);
					touchStartOffsetX = 0;
					touchStartOffsetY = 0;
					console.log("end");
				}


				function checkDragOverTabs(xPos, yPos)
				{
					if (tabsRect.contains(xPos, yPos))
					{
						if (londonRect.contains(xPos, yPos))
						{
							console.log("over london");
							openCity('London')
						}
						else if (parisRect.contains(xPos, yPos))
						{
							console.log("over paris");
							openCity('Paris')
						}
						else if (tokyoRect.contains(xPos, yPos))
						{
							console.log("over tokyo");
							openCity('Tokyo')
						}
						else {
							console.log("over empty tabs area");
						}
					}
				}
				
				/*
				//https://github.com/SortableJS/Sortable/issues/1292
				function mousePosition(e){		
					var xPos = e.pageX - touchStartOffsetX;
					var yPos = e.pageY - touchStartOffsetY;
				
					$("#x").val(xPos);
					$("#y").val(yPos);
				}
				*/

				var touchStartOffsetX = 0;
				var touchStartOffsetY = 0;

				function touchPosition(e){
					var xPos = e.targetTouches[0].pageX - touchStartOffsetX;
					var yPos = e.targetTouches[0].pageY - touchStartOffsetY;
					
					checkDragOverTabs(xPos, yPos);

					$("#x").val(xPos);
					$("#y").val(yPos);
				}			

				
				
				// Generate 100 items
				list1WithHandle.innerHTML = Array.apply(null,  new Array(100)).map(function (v, i) {
				  return '<div class="list-group-item">' +
				  '<span class="badge">' + (i + 1) + '</span>' +
				  '<span class="glyphicon glyphicon-move" aria-hidden="true">&nbsp;</span>' +
				  
				  'P item ' +
					(i + 1) +
					'</div>';
				}).join('');

				list2WithHandle.innerHTML = Array.apply(null,  new Array(100)).map(function (v, i) {
				  return '<div class="list-group-item">' +
				  '<span class="badge">' + (i + 1) + '</span>' +
				  '<span class="glyphicon glyphicon-move" aria-hidden="true">&nbsp;</span>' +
				  
				  'T item ' +
					(i + 1) +
					'</div>';
				}).join('');


			}); //ready

		</script>

	</body>
</html>
